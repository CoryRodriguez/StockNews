---
phase: 05-frontend-bot-dashboard
plan: "05-02"
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/types/index.ts
  - frontend/src/store/botStore.ts
autonomous: true
requirements:
  - UI-01
  - UI-02
  - UI-03
  - UI-04
  - UI-05
  - UI-06
  - UI-07

must_haves:
  truths:
    - "PanelType union in types/index.ts includes 'bot'"
    - "WsMessage union includes bot_status_update, bot_trade_closed, bot_signal_evaluated message shapes"
    - "botStore.ts exports useBotStore with state slices: status, positions, trades, signals, config"
    - "botStore setters: setStatus, setPositions, prependTrade, setTrades, prependSignal, setSignals, setConfig"
    - "BotStatus, BotPosition, BotTrade, BotSignal, BotConfig interfaces are exported from botStore.ts"
  artifacts:
    - frontend/src/store/botStore.ts
  key_links:
    - "PanelType addition in types/index.ts is required by Dashboard.tsx (Plan 05-03) and dashboardStore.ts"
    - "WsMessage types are consumed by useSocket.ts (Plan 05-03)"
    - "useBotStore is consumed by BotPanel.tsx (Plan 05-04)"
---

<objective>
Create the frontend data layer: extend TypeScript types for bot panel support and create the Zustand store that holds all server-sourced bot data.

Purpose: Plans 05-03 and 05-04 both depend on these types and the store. Creating them first in Wave 1 (parallel with 05-01) ensures downstream plans have stable contracts to build against.

Output:
- `frontend/src/types/index.ts` — `"bot"` added to PanelType union; three new WsMessage variants added
- `frontend/src/store/botStore.ts` — new Zustand slice with full bot state shape and setters
</objective>

<execution_context>
@C:/Users/Owner/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Owner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/05-frontend-bot-dashboard/05-CONTEXT.md
@.planning/phases/05-frontend-bot-dashboard/05-RESEARCH.md

<interfaces>
<!-- Existing types/index.ts shape the executor must preserve and extend -->

Current PanelType (line 80):
```typescript
export type PanelType = "scanner" | "chart" | "news" | "watchlist" | "trades" | "analytics";
// ADD: | "bot"
```

Current WsMessage union (lines 108-114):
```typescript
export type WsMessage =
  | { type: "connected" }
  | { type: "news_article"; article: NewsArticle; channel: string }
  | { type: "scanner_alert"; channel: string; scannerId: string } & ScannerAlert
  | { type: "scanner_clear"; channel: string; scannerId: string; ticker: string }
  | { type: "quote_update"; channel: string; ticker: string; price: number; volume?: number }
  | { type: "trade_update"; channel: string; trade: PaperTrade };
// ADD three new bot variants below
```

Existing Zustand store pattern (from frontend/src/store/tradesStore.ts):
```typescript
import { create } from "zustand";
export const useTradesStore = create<State>((set) => ({
  trades: [],
  setTrades: (trades) => set({ trades }),
  upsertTrade: (trade) => set((s) => ({ trades: [trade, ...s.trades.filter(t => t.id !== trade.id)] })),
}));
```

BotConfigRecord fields from backend (for BotConfig interface alignment):
```typescript
// All fields are numbers or strings (no Dates on the frontend side — updatedAt is excluded)
positionSizeUsd, confidenceMultiplierHigh, confidenceMultiplierMed, confidenceMultiplierLow,
maxConcurrentPositions, dailyLossLimitUsd, minWinRate, hardStopLossPct, maxHoldDurationSec,
enabledCatalystTiers (string "1,2,3,4"), maxFloatShares, maxSharePrice, minRelativeVolume,
tradeSizeStars3, tradeSizeStars4, tradeSizeStars5, profitTargetPct, trailingStopPct, trailingStopDollar
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend types/index.ts — add "bot" to PanelType and three WsMessage variants</name>
  <files>frontend/src/types/index.ts</files>
  <action>
Open `frontend/src/types/index.ts` and make two targeted edits:

**Edit 1 — PanelType union (line ~80):**
Change:
```typescript
export type PanelType = "scanner" | "chart" | "news" | "watchlist" | "trades" | "analytics";
```
To:
```typescript
export type PanelType = "scanner" | "chart" | "news" | "watchlist" | "trades" | "analytics" | "bot";
```

**Edit 2 — WsMessage union (after the last existing variant):**
Add three new bot message variants. Place them before the closing semicolon of the WsMessage union. The BotStatus, BotPosition, BotTrade, and BotSignal types will be defined in botStore.ts and imported from there — so for now, inline the minimal shapes directly in types/index.ts OR (preferred) use `import type` from botStore once it exists. Since this plan runs in parallel with botStore creation, inline the shapes directly in types/index.ts to avoid a circular dependency:

```typescript
export type WsMessage =
  | { type: "connected" }
  | { type: "news_article"; article: NewsArticle; channel: string }
  | { type: "scanner_alert"; channel: string; scannerId: string } & ScannerAlert
  | { type: "scanner_clear"; channel: string; scannerId: string; ticker: string }
  | { type: "quote_update"; channel: string; ticker: string; price: number; volume?: number }
  | { type: "trade_update"; channel: string; trade: PaperTrade }
  | { type: "bot_status_update"; channel: string; status: { state: string; mode: string; openPositionCount: number; todayRealizedPnl: number; todayTradeCount: number; dayTradeCount: number; marketOpen: boolean } }
  | { type: "bot_trade_closed"; channel: string; trade: { id: string; symbol: string; entryPrice: number | null; exitPrice: number | null; shares: number | null; pnl: number | null; catalystType: string | null; exitReason: string | null; entryAt: string | null; exitAt: string | null } }
  | { type: "bot_signal_evaluated"; channel: string; signal: { id: string; symbol: string; catalystCategory: string | null; catalystTier: number | null; rejectReason: string | null; evaluatedAt: string } };
```

Keep the inline types simple and self-contained to avoid import cycles. useSocket.ts will use these types to narrow the WsMessage union.
  </action>
  <verify>
    <automated>cd C:/Projects/StockNews/frontend && npx tsc --noEmit 2>&1 | head -20</automated>
  </verify>
  <done>tsc --noEmit passes. PanelType includes "bot". WsMessage union has bot_status_update, bot_trade_closed, bot_signal_evaluated variants.</done>
</task>

<task type="auto">
  <name>Task 2: Create botStore.ts — Zustand slice for all bot state</name>
  <files>frontend/src/store/botStore.ts</files>
  <action>
Create `frontend/src/store/botStore.ts` as a new file. Follow the exact pattern of `tradesStore.ts` and `scannerStore.ts`.

```typescript
import { create } from "zustand";

// ── Bot domain types ──────────────────────────────────────────────────────────

export interface BotStatus {
  state: "stopped" | "running" | "paused";
  mode: "paper" | "live";
  openPositionCount: number;
  todayRealizedPnl: number;
  todayTradeCount: number;
  dayTradeCount: number;
  marketOpen: boolean;
}

export interface BotPosition {
  id: string;
  symbol: string;
  entryPrice: number | null;
  shares: number | null;
  catalystType: string | null;
  entryAt: string | null;
  status: string;
}

export interface BotTrade {
  id: string;
  symbol: string;
  entryPrice: number | null;
  exitPrice: number | null;
  shares: number | null;
  pnl: number | null;
  catalystType: string | null;
  exitReason: string | null;
  entryAt: string | null;
  exitAt: string | null;
  status: string;
}

export interface BotSignal {
  id: string;
  symbol: string;
  catalystCategory: string | null;
  catalystTier: number | null;
  rejectReason: string | null;
  evaluatedAt: string;
  headline?: string | null;
  source?: string | null;
}

export interface BotConfig {
  enabledCatalystTiers: string;
  positionSizeUsd: number;
  confidenceMultiplierHigh: number;
  confidenceMultiplierMed: number;
  confidenceMultiplierLow: number;
  maxConcurrentPositions: number;
  dailyLossLimitUsd: number;
  minWinRate: number;
  hardStopLossPct: number;
  maxHoldDurationSec: number;
  maxFloatShares: number;
  maxSharePrice: number;
  minRelativeVolume: number;
  tradeSizeStars3: number;
  tradeSizeStars4: number;
  tradeSizeStars5: number;
  profitTargetPct: number;
  trailingStopPct: number;
  trailingStopDollar: number;
}

// ── Store ─────────────────────────────────────────────────────────────────────

interface BotState {
  status: BotStatus | null;
  positions: BotPosition[];
  trades: BotTrade[];
  signals: BotSignal[];
  config: BotConfig | null;

  setStatus: (s: BotStatus) => void;
  setPositions: (p: BotPosition[]) => void;
  prependTrade: (t: BotTrade) => void;
  setTrades: (t: BotTrade[]) => void;
  prependSignal: (s: BotSignal) => void;
  setSignals: (s: BotSignal[]) => void;
  setConfig: (c: BotConfig) => void;
}

export const useBotStore = create<BotState>((set) => ({
  status: null,
  positions: [],
  trades: [],
  signals: [],
  config: null,

  setStatus: (status) => set({ status }),
  setPositions: (positions) => set({ positions }),
  prependTrade: (t) => set((s) => ({ trades: [t, ...s.trades].slice(0, 100) })),
  setTrades: (trades) => set({ trades }),
  prependSignal: (sig) => set((s) => ({ signals: [sig, ...s.signals].slice(0, 100) })),
  setSignals: (signals) => set({ signals }),
  setConfig: (config) => set({ config }),
}));
```

Note: `BotPosition` uses the full BotTrade DB shape (since the `/positions` endpoint returns BotTrade rows filtered to status='open'). The `id` field is included because BotPanel needs it for React keys.
  </action>
  <verify>
    <automated>cd C:/Projects/StockNews/frontend && npx tsc --noEmit 2>&1 | head -20</automated>
  </verify>
  <done>botStore.ts exists. tsc --noEmit passes. useBotStore is exported. All seven setter functions exist. All five exported interfaces exist.</done>
</task>

</tasks>

<verification>
Run after both tasks complete:
```bash
cd C:/Projects/StockNews/frontend && npx tsc --noEmit 2>&1 | head -20
```
Expected: no TypeScript errors.

Spot-check type additions:
```bash
grep -n '"bot"' C:/Projects/StockNews/frontend/src/types/index.ts
grep -n "bot_status_update\|bot_trade_closed\|bot_signal_evaluated" C:/Projects/StockNews/frontend/src/types/index.ts
grep -n "useBotStore\|BotStatus\|BotConfig" C:/Projects/StockNews/frontend/src/store/botStore.ts
```
</verification>

<success_criteria>
- tsc --noEmit passes with zero errors in the frontend
- `"bot"` is part of the PanelType union
- Three bot WsMessage variants are in the WsMessage union
- `frontend/src/store/botStore.ts` exists with all interfaces and store exported
- No circular imports introduced
</success_criteria>

<output>
After completion, create `.planning/phases/05-frontend-bot-dashboard/05-02-SUMMARY.md` using the summary template.
</output>
